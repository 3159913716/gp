# 接口与数据表映射文档

## 1. 项目概述

本文档梳理了Big Event Spring Boot项目中的所有接口及其对应的数据库表信息，明确了数据操作的对应关系和操作依据，便于开发人员理解系统架构和数据流程。

## 2. 接口与数据表映射关系

### 2.1 用户管理模块

| 接口名称 | URL | 方法 | 对应数据表 | 操作类型 |
|---------|-----|------|----------|--------|
| 用户注册 | /user/register | POST | user | 新增 |
| 用户登录 | /user/login | POST | user | 查询 |
| 获取用户信息 | /user/userInfo | GET | user | 查询 |
| 更新用户信息 | /user/update | PUT | user | 更新 |
| 更新头像 | /user/updateAvatar | PATCH | user | 更新 |
| 更新密码 | /user/updatePwd | PUT | user | 更新 |
| 获取我的收藏列表 | /user/collections | GET | user, article, article_collect | 查询 |
| 关注/取消关注用户 | /user/follow | POST | user_follow | 新增/删除 |
| 获取关注列表 | /user/following | GET | user, user_follow | 查询 |
| 获取粉丝列表 | /user/followers | GET | user, user_follow | 查询 |
| 提交作者申请 | /user/apply-author | POST | author_apply | 新增 |
| 获取申请状态 | /user/apply-status | GET | author_apply | 查询 |

### 2.2 文章管理模块

| 接口名称 | URL | 方法 | 对应数据表 | 操作类型 |
|---------|-----|------|----------|--------|
| 新增文章 | /article/add | POST | article | 新增 |
| 文章列表 | /article/list | GET | article | 查询 |
| 根据ID获取文章 | /article/detail | GET | article | 查询 |
| 更新文章 | /article/update | PUT | article | 更新 |
| 删除文章 | /article/delete | DELETE | article | 删除 |
| 首页文章列表 | /article/home | GET | article | 查询 |
| 点赞/取消点赞 | /article/like | POST | article_like, article | 新增/删除 |
| 收藏/取消收藏 | /article/collect | POST | article_collect, article | 新增/删除 |

### 2.3 分类管理模块

| 接口名称 | URL | 方法 | 对应数据表 | 操作类型 |
|---------|-----|------|----------|--------|
| 新增分类 | /category/add | POST | category | 新增 |
| 分类列表 | /category/list | GET | category | 查询 |
| 更新分类 | /category/update | PUT | category | 更新 |
| 删除分类 | /category/delete | DELETE | category | 删除 |

### 2.4 管理员模块

| 接口名称 | URL | 方法 | 对应数据表 | 操作类型 |
|---------|-----|------|----------|--------|
| 审核作者申请 | /admin/audit-author | PUT | author_apply, user | 更新 |
| 修改用户角色 | /admin/update-role | PUT | user | 更新 |
| 获取作者申请列表 | /admin/author-applies | GET | author_apply | 查询 |
| 获取用户列表 | /admin/users | GET | user | 查询 |
| 获取数据统计 | /admin/statistics | GET | user, article | 查询 |

### 2.5 其他模块

| 接口名称 | URL | 方法 | 对应数据表 | 操作类型 |
|---------|-----|------|----------|--------|
| 发送验证码 | /api/email/send-code | POST | 无（Redis缓存） | 新增 |
| 验证验证码 | /api/email/verify | POST | 无（Redis缓存） | 查询 |
| 文件上传 | /upload | POST | 无（阿里云OSS） | 新增 |
| 搜索文章 | /search | GET | article | 查询 |

## 3. 数据表结构说明

### 3.1 user表（用户表）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | VARCHAR(20) | UNIQUE, NOT NULL | 用户名 |
| password | VARCHAR(100) | NOT NULL | 密码（加密存储） |
| nickname | VARCHAR(10) | NOT NULL | 昵称 |
| email | VARCHAR(50) | UNIQUE, NOT NULL | 邮箱 |
| user_pic | VARCHAR(200) | | 用户头像地址 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| role | INT | DEFAULT 2 | 用户角色：0-管理员，1-作者，2-普通用户 |
| status | INT | DEFAULT 0 | 账号状态：0-正常，1-禁用 |

（无外键约束，为基础表）

### 3.2 article表（文章表）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 文章ID |
| title | VARCHAR(10) | NOT NULL | 文章标题（1~10个字符） |
| content | TEXT | NOT NULL | 文章内容 |
| cover_img | VARCHAR(200) | NOT NULL | 封面图片URL |
| state | VARCHAR(10) | NOT NULL | 文章状态（如：已发布、草稿） |
| category_id | INT | FOREIGN KEY REFERENCES category(id) | 分类ID |
| create_user | INT | FOREIGN KEY REFERENCES user(id) | 创建用户ID |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| like_count | INT | DEFAULT 0 | 点赞数 |
| collect_count | INT | DEFAULT 0 | 收藏数 |

（受category表和user表的外键约束）

### 3.3 category表（分类表）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 分类ID |
| category_name | VARCHAR(20) | NOT NULL | 分类名称 |
| category_alias | VARCHAR(20) | NOT NULL | 分类别名 |
| create_user | INT | FOREIGN KEY REFERENCES user(id) | 创建用户ID |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

（受user表的外键约束）

### 3.4 article_collect表（文章收藏表）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 收藏记录ID |
| user_id | INT | FOREIGN KEY REFERENCES user(id) | 用户ID |
| article_id | INT | FOREIGN KEY REFERENCES article(id) | 文章ID |
| collect_time | DATETIME | NOT NULL | 收藏时间 |
| is_deleted | INT | DEFAULT 0 | 是否删除（逻辑删除：0-未删除，1-已删除） |

（受user表和article表的外键约束）

### 3.5 article_like表（文章点赞表）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 点赞记录ID |
| article_id | INT | FOREIGN KEY REFERENCES article(id) | 文章ID |
| user_id | INT | FOREIGN KEY REFERENCES user(id) | 用户ID |
| create_time | DATETIME | NOT NULL | 点赞时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| is_deleted | INT | DEFAULT 0 | 是否删除（逻辑删除：0-未删除，1-已删除） |

（受article表和user表的外键约束）

### 3.6 user_follow表（用户关注表）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 关注记录ID |
| follower_id | INT | FOREIGN KEY REFERENCES user(id) | 关注者ID |
| followed_id | INT | FOREIGN KEY REFERENCES user(id) | 被关注者ID |
| create_time | DATETIME | NOT NULL | 关注时间 |
| is_deleted | INT | DEFAULT 0 | 是否删除（逻辑删除：0-未删除，1-已删除） |

（受user表的外键约束）

### 3.7 author_apply表（作者申请表）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|-----|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 申请记录ID |
| user_id | INT | FOREIGN KEY REFERENCES user(id) | 用户ID |
| real_name | VARCHAR(20) | NOT NULL | 真实姓名 |
| id_card | VARCHAR(50) | NOT NULL | 身份证号（加密存储） |
| apply_desc | TEXT | | 申请描述 |
| status | INT | DEFAULT 0 | 申请状态：0-待审核，1-通过，2-拒绝 |
| create_time | DATETIME | NOT NULL | 申请时间 |
| audit_time | DATETIME | | 审核时间 |
| audit_user_id | INT | FOREIGN KEY REFERENCES user(id) | 审核管理员ID |
| reject_reason | TEXT | | 拒绝原因 |

（受user表的外键约束）

## 4. 数据操作关系说明

### 4.1 关联操作说明

在数据处理过程中，需特别注意外键约束相关的数据处理：

1. **插入数据时**：
   - 当插入article表数据时，必须确保category_id对应的分类存在于category表中，且create_user对应的用户存在于user表中
   - 当插入article_collect/article_like表数据时，必须确保user_id和article_id分别对应有效的user表和article表记录
   - 当插入user_follow表数据时，必须确保follower_id和followed_id都对应有效的user表记录
   - 当插入author_apply表数据时，必须确保user_id和audit_user_id（如有）都对应有效的user表记录

2. **更新数据时**：
   - 更新外键字段时，必须确保新值对应的记录存在于关联表中
   - 例如更新article表的category_id时，需确保新的category_id存在于category表

3. **删除数据时**：
   - 采用级联删除或逻辑删除策略，避免违反外键约束
   - 系统中article_collect、article_like、user_follow等关联表使用逻辑删除（is_deleted字段）
   - 当删除被引用的基础表记录时，需先处理依赖该记录的所有关联数据

### 4.2 业务逻辑约束

1. **用户-文章关联**：
   - 用户创建文章时，`article`表的`create_user`字段关联到`user`表的`id`字段
   - 获取用户文章列表时，通过`create_user`字段过滤

2. **文章-分类关联**：
   - 文章发布时需选择分类，`article`表的`category_id`字段关联到`category`表的`id`字段
   - 查询分类下文章时，通过`category_id`字段过滤

3. **用户-关注关联**：
   - 用户关注其他用户时，在`user_follow`表中记录`follower_id`（关注者）和`followed_id`（被关注者）
   - 获取关注列表和粉丝列表时，通过这两个字段进行查询

4. **用户-收藏关联**：
   - 用户收藏文章时，在`article_collect`表中记录`user_id`和`article_id`
   - 收藏操作会同时更新`article`表中的`collect_count`字段

5. **用户-点赞关联**：
   - 用户点赞文章时，在`article_like`表中记录`user_id`和`article_id`
   - 点赞操作会同时更新`article`表中的`like_count`字段

6. **用户-作者申请关联**：
   - 用户提交作者申请时，在`author_apply`表中记录`user_id`
   - 管理员审核通过后，会更新`user`表中对应用户的`role`字段为1（作者）

### 4.2 业务逻辑约束

1. **用户注册**：用户名和邮箱必须唯一，密码需要加密存储
2. **文章发布**：只能发布到已存在的分类，且作者必须是当前登录用户
3. **关注操作**：不能关注自己，不能重复关注同一用户
4. **点赞收藏**：不能对同一文章重复点赞/收藏，点赞/收藏后取消操作采用逻辑删除
5. **作者申请**：每个用户只能提交一次申请，审核通过后不能再次申请
6. **管理员操作**：管理员操作需要权限验证，且会记录操作日志

## 5. 数据插入依据

1. **基础数据插入**：
   - 系统初始化时需创建管理员账户（role=0）
   - 创建必要的默认文章分类

2. **用户数据插入**：
   - 通过注册接口添加新用户
   - 密码使用加密算法加密后存储
   - 初始用户角色为普通用户（role=2）

3. **文章数据插入**：
   - 作者用户发布文章时添加
   - 文章状态默认为草稿，发布后更新状态
   - 初始点赞数和收藏数为0

4. **关联数据插入**：
   - 关注/点赞/收藏操作时自动添加
   - 关联表使用逻辑删除机制，避免频繁删除重建索引

5. **管理数据插入**：
   - 作者申请记录由用户提交生成
   - 管理员审核后更新状态

本文档提供了系统接口与数据库表的完整映射关系，为开发和维护提供了明确的数据操作依据。