# 大事件项目新增接口详细设计文档

端口号统一为8080

## 一、用户交互相关接口

### 1.1 点赞/收藏相关接口

#### 1.1.1 点赞/取消点赞文章

**接口名称**: 文章点赞操作
**请求方法**: POST
**接口路径**: `/article/{id}/like`
**权限要求**: 登录用户 (role=1,2)

**请求参数**:
- Path参数: id (文章ID)
- Header: Authorization: Bearer {token}

**业务逻辑**:

1. 验证用户登录状态和token有效性
2. 检查文章是否存在且状态为"已发布"
3. 查询article_like表，判断用户是否已点赞
   - 如果未点赞：插入点赞记录，article表like_count+1
   - 如果已点赞：逻辑删除点赞记录，article表like_count-1
4. 返回操作后的点赞状态和总点赞数

**响应数据**:

```json
{
  "code": 0,
  "message": "操作成功",
  "data": {
    "liked": true,
    "likeCount": 25
  }
}
```

#### 1.1.2 收藏/取消收藏文章

**接口名称**: 文章收藏操作
**请求方法**: POST
**接口路径**: `/article/{id}/collect`
**权限要求**: 登录用户 (role=1,2)

**业务逻辑**:
1. 验证用户登录状态
2. 检查文章是否存在且状态为"已发布"
3. 查询article_collect表，判断用户是否已收藏
   - 如果未收藏：插入收藏记录，article表collect_count+1
   - 如果已收藏：逻辑删除收藏记录，article表collect_count-1
4. 返回操作后的收藏状态和总收藏数

**响应数据**:

```json
{
  "code": 0,
  "message": "操作成功",
  "data": {
    "collected": true,
    "collectCount": 15
  }
}
```

#### 1.1.3 获取我的收藏列表

**接口名称**: 我的收藏列表
**请求方法**: GET
**接口路径**: `/user/collections`
**权限要求**: 登录用户 (role=1,2)

**请求参数**:
- Query: page=1&pageSize=10
- Header: Authorization: Bearer {token}

**业务逻辑**:
1. 从token中获取用户ID
2. 联表查询article_collect和article表
3. 过滤已逻辑删除的记录
4. 按收藏时间倒序分页返回

**响应数据**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "文章标题",
        "coverImg": "封面图URL",
        "author": "作者名",
        "collectTime": "2024-01-01 10:00:00"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 10
  }
}
```



### 1.2 关注相关接口

#### 1.2.1 关注/取消关注用户

**接口名称**: 关注用户操作
**请求方法**: POST
**接口路径**: `/user/{id}/follow`
**权限要求**: 登录用户 (role=1,2)

**业务逻辑**:
1. 验证用户登录状态
2. 检查被关注用户是否存在且不是自己
3. 查询user_follow表，判断是否已关注
   - 如果未关注：插入关注记录
   - 如果已关注：逻辑删除关注记录
4. 返回操作后的关注状态

**响应数据**:

```JSON
{
  "code": 0,
  "message": "操作成功",
  "data": {
    "following": true
  }
}
```



#### 1.2.2 获取关注列表

**接口名称**: 我的关注列表
**请求方法**: GET
**接口路径**: `/user/following`
**权限要求**: 登录用户 (role=1,2)

**业务逻辑**:
1. 从token中获取用户ID
2. 联表查询user_follow和USER表
3. 过滤已逻辑删除的记录
4. 返回关注用户的详细信息

**响应数据**:

```
{
  "code": 0,
  "message": "success",
  "data": [
    {
      "userId": 2,
      "username": "被关注用户",
      "nickname": "昵称",
      "userPic": "头像URL",
      "followTime": "2024-01-01 10:00:00"
    }
  ]
}
```



### 1.3 评论相关接口

#### 1.3.1 发布评论

**接口名称**: 发布评论
**请求方法**: POST
**接口路径**: `/article/{id}/comments`
**权限要求**: 登录用户 (role=1,2)

**请求体**:

```
{
  "content": "评论内容",
  "parentId": 0 // 0表示顶级评论，其他值表示回复某条评论
}
```

**业务逻辑**:

1. 验证用户登录状态
2. 检查文章是否存在
3. 如果parentId>0，检查父评论是否存在
4. 插入评论记录到article_comment表
5. 返回评论详情

**响应数据**:

```json
{
  "code": 0,
  "message": "评论成功",
  "data": {
    "id": 1,
    "content": "评论内容",
    "userInfo": {
      "nickname": "用户昵称",
      "userPic": "用户头像"
    },
    "createTime": "2024-01-01 10:00:00"
  }
}
```



#### 1.3.2 获取文章评论列表

**接口名称**: 文章评论列表
**请求方法**: GET
**接口路径**: `/article/{id}/comments`
**权限要求**: 无（公开接口）

**请求参数**:
- Path: id (文章ID)
- Query: page=1&pageSize=20

**业务逻辑**:
1. 检查文章是否存在
2. 查询article_comment表，按创建时间倒序
3. 关联USER表获取评论者信息
4. 构建评论树形结构（支持二级回复）
5. 分页返回

**响应数据**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "content": "评论内容",
        "userInfo": {...},
        "createTime": "...",
        "likeCount": 5,
        "liked": false,
        "replies": [
          // 回复列表
        ]
      }
    ],
    "total": 100
  }
}
```

#### 1.3.3 点赞/取消点赞评论

**接口名称**: 评论点赞操作
**请求方法**: POST
**接口路径**: `/comment/{id}/like`
**权限要求**: 登录用户 (role=1,2)

**请求参数**:
- Path参数: id (评论ID)
- Header: Authorization: Bearer {token}

**业务逻辑**:

1. 验证用户登录状态和token有效性
2. 检查评论是否存在且未被删除
3. 查询comment_like表，判断用户是否已点赞
   - 如果未点赞：插入点赞记录，article_comment表like_count+1
   - 如果已点赞：逻辑删除点赞记录，article_comment表like_count-1
4. 返回操作后的点赞状态和总点赞数

**响应数据**:

```json
{
  "code": 0,
  "message": "操作成功",
  "data": {
    "liked": true,
    "likeCount": 5
  }
}
```


### 1.4 作者申请相关接口

#### 1.4.1 提交作者申请

**接口名称**: 提交作者申请
**请求方法**: POST
**接口路径**: `/author/apply`
**权限要求**: 普通用户 (role=2)

**请求体**:

```json
{
  "realName": "真实姓名",
  "idCard": "身份证号",
  "applyDesc": "申请描述"
}
```

**业务逻辑**:

1. 验证用户角色必须是普通用户
2. 检查用户是否已有待审核的申请
3. 身份证号加密存储
4. 插入申请记录到author_apply表，状态为待审核
5. 记录操作日志

**响应数据**:

```json
{
  "code": 0,
  "message": "申请提交成功，等待审核"
}
```



## 二、后台管理接口

### 2.1 用户管理接口

#### 2.1.1 获取用户列表

**接口名称**: 用户列表
**请求方法**: GET
**接口路径**: `/admin/users`
**权限要求**: 管理员 (role=0)

**请求参数**:
- Query: page=1&pageSize=10&role=&username=&status=

**业务逻辑**:
1. 验证管理员权限
2. 多条件动态查询USER表
3. 排除管理员自己的账户（可选）
4. 分页返回用户列表

**响应数据**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "username": "用户名",
        "nickname": "昵称",
        "email": "邮箱",
        "role": 2,
        "status": 0,
        "createTime": "注册时间"
      }
    ],
    "total": 100
  }
}
```



#### 2.1.2 修改用户角色

**接口名称**: 修改用户角色
**请求方法**: PUT
**接口路径**: `/admin/users/{id}/role`
**权限要求**: 管理员 (role=0)

**请求体**:

```json
{
  "role": 1
}
```

**业务逻辑**:

1. 验证管理员权限
2. 检查目标用户是否存在
3. 更新用户角色
4. 如果是改为作者，检查是否有作者申请记录并更新状态
5. 记录管理员操作日志

**响应数据**:

```json
{
  "code": 0,
  "message": "用户角色修改成功"
}
```



### 2.2 审核管理接口

#### 2.2.1 获取作者申请列表

**接口名称**: 作者申请列表
**请求方法**: GET
**接口路径**: `/admin/author-applies`
**权限要求**: 管理员 (role=0)

**请求参数**:
- Query: page=1&pageSize=10&status=0

**业务逻辑**:
1. 验证管理员权限
2. 联表查询author_apply和USER表
3. 根据状态过滤（待审核/已通过/已拒绝）
4. 身份证号解密显示（部分隐藏）
5. 分页返回

**响应数据**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "userInfo": {...},
        "realName": "张*",
        "idCard": "110101******1234",
        "applyDesc": "申请描述",
        "status": 0,
        "createTime": "申请时间"
      }
    ],
    "total": 15
  }
}
```



#### 2.2.2 通过作者申请

**接口名称**: 通过作者申请
**请求方法**: PUT
**接口路径**: `/admin/author-applies/{id}/approve`
**权限要求**: 管理员 (role=0)

**业务逻辑**:
1. 验证管理员权限
2. 检查申请是否存在且状态为待审核
3. 更新申请状态为通过，记录审核时间和审核人
4. 更新对应用户的角色为作者(role=1)
5. 记录管理员操作日志

**响应数据**:

```json
{
  "code": 0,
  "message": "申请已通过"
}
```



### 2.3 数据统计接口

#### 2.3.1 获取数据统计

**接口名称**: 数据统计
**请求方法**: GET
**接口路径**: `/admin/statistics`
**权限要求**: 管理员 (role=0)

**业务逻辑**:
1. 验证管理员权限
2. 统计总用户数、总文章数、今日新增用户、今日新增文章
3. 计算日活跃用户（今日有登录或操作的用户）
4. 获取近7天数据趋势

**响应数据**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "totalUsers": 1000,
    "totalArticles": 5000,
    "todayNewUsers": 10,
    "todayNewArticles": 25,
    "dailyActiveUsers": 150,
    "trendData": {
      "dates": ["01-01", "01-02", ...],
      "users": [10, 15, ...],
      "articles": [20, 25, ...]
    }
  }
}
```



## 三、前台展示接口

### 3.1 首页相关接口

#### 3.1.1 首页文章列表

**接口名称**: 首页文章列表
**请求方法**: GET
**接口路径**: `/article/home`
**权限要求**: 无（公开接口）

**请求参数**:
- Query: page=1&pageSize=10&sort=new|hot

**业务逻辑**:
1. 根据sort参数排序
   - new: 按创建时间倒序
   - hot: 按点赞数+收藏数综合排序
2. 只返回状态为"已发布"的文章
3. 关联用户表获取作者信息
4. 返回文章基本信息（标题、封面、摘要、作者、时间、点赞收藏数）

**响应数据**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "文章标题",
        "coverImg": "封面图",
        "summary": "文章摘要",
        "author": "作者名",
        "createTime": "发布时间",
        "likeCount": 25,
        "collectCount": 15,
        "commentCount": 8
      }
    ],
    "total": 1000
  }
}
```



### 3.2 搜索相关接口

#### 3.2.1 搜索文章

**接口名称**: 搜索文章
**请求方法**: GET
**接口路径**: `/search`
**权限要求**: 无（公开接口）

**请求参数**:
- Query: keyword=搜索词&page=1&pageSize=10

**业务逻辑**:
1. 对关键词进行trim和安全性检查
2. 在article表中搜索标题和内容包含关键词的文章
3. 只返回状态为"已发布"的文章
4. 高亮显示匹配的关键词
5. 分页返回结果

**响应数据**:

```
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [...],
    "total": 50,
    "keyword": "搜索词"
  }
}
```



## 四、个人中心接口

### 4.1 作者专属接口

#### 4.1.1 获取我的文章列表

**接口名称**: 我的文章列表
**请求方法**: GET
**接口路径**: `/user/articles`
**权限要求**: 作者 (role=1)

**请求参数**:
- Query: page=1&pageSize=10&state=草稿|已发布

**业务逻辑**:
1. 从token中获取用户ID
2. 查询该用户创建的所有文章
3. 可根据状态过滤
4. 包含文章的统计信息（点赞、收藏、评论数）
5. 分页返回

**响应数据**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "文章标题",
        "state": "已发布",
        "categoryName": "分类名称",
        "createTime": "创建时间",
        "likeCount": 25,
        "collectCount": 15,
        "commentCount": 8
      }
    ],
    "total": 50
  }
}
```



## 五、权限控制说明

### 5.1 接口权限层级

- **公开接口**: 无需登录即可访问（首页、搜索、文章详情等）
- **用户接口**: 需要登录（role=1,2），如点赞、收藏、评论
- **作者接口**: 需要作者权限（role=1），如文章管理
- **管理员接口**: 需要管理员权限（role=0），如用户管理、审核管理

### 5.2 权限验证方式

1. **路由守卫**: 前端路由跳转时验证权限
2. **接口拦截**: 后端每个接口进行角色验证
3. **Token验证**: JWT token包含用户角色信息



